[{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\components\\CalibrationScreen.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\components\\CalibrationScreen.tsx:24:7\n  22 |   useEffect(() => {\n  23 |     if (prevIsRunning.current && !isRunning && elapsedTime > 500) {\n> 24 |       setAttempts(prev => [...prev, elapsedTime]);\n     |       ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  25 |     }\n  26 |     prevIsRunning.current = isRunning;\n  27 |   }, [isRunning, elapsedTime]);","line":24,"column":7,"nodeType":null,"endLine":24,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect } from 'react';\nimport { ArrowLeft, Play, Square, Check, RotateCcw } from 'lucide-react';\nimport type { DikrItem, Language } from '../types';\nimport { t } from '../i18n';\n\ninterface Props {\n  lang: Language;\n  dikr: DikrItem;\n  elapsedTime: number;\n  isRunning: boolean;\n  onToggle: () => void;\n  onBack: () => void;\n  onSave: (durationMs: number) => void;\n  onFinish: () => void;\n  onReset: () => void;\n}\n\nexport function CalibrationScreen({ lang, dikr, elapsedTime, isRunning, onToggle, onBack, onSave, onReset, onFinish }: Props) {\n  const [attempts, setAttempts] = useState<number[]>([]);\n  const prevIsRunning = useRef(isRunning);\n\n  useEffect(() => {\n    if (prevIsRunning.current && !isRunning && elapsedTime > 500) {\n      setAttempts(prev => [...prev, elapsedTime]);\n    }\n    prevIsRunning.current = isRunning;\n  }, [isRunning, elapsedTime]);\n\n  const handleSave = () => {\n    const allAttempts = attempts.length > 0 ? attempts : (elapsedTime > 500 ? [elapsedTime] : []);\n    if (allAttempts.length === 0) return;\n    \n    const avg = allAttempts.reduce((a, b) => a + b, 0) / allAttempts.length;\n    onSave(avg);\n    onFinish();\n  };\n\n  const handleToggle = () => {\n     if (!isRunning && elapsedTime > 0) {\n        onReset();\n        setTimeout(() => {\n           onToggle();\n        }, 10);\n     } else {\n        onToggle();\n     }\n  };\n\n  const handleReset = () => {\n     if (elapsedTime === 0 && attempts.length > 0) {\n        setAttempts([]);\n     } else {\n        onReset();\n     }\n  };\n\n  return (\n    <div className=\"flex flex-col items-center justify-between w-full min-h-screen max-w-md p-6 pb-12 animate-in slide-in-from-right-4 duration-300\">\n      <header className=\"w-full flex items-center justify-between\">\n        <button onClick={onBack} className={`p-2 ${lang === 'ar' ? '-mr-2' : '-ml-2'} text-slate-400 hover:text-white transition-colors`}>\n          <ArrowLeft size={24} className={lang === 'ar' ? 'rotate-180' : ''} />\n        </button>\n        <span className=\"text-sm font-medium text-slate-300 uppercase tracking-wider\">{t(lang, 'calibrationTitle')}</span>\n        <div className=\"w-10\" />\n      </header>\n\n      <main className=\"flex flex-col items-center w-full flex-1 justify-center mt-8\">\n        <div className=\"text-center mb-10\">\n          <h2 className=\"text-2xl font-bold text-white mb-2\">{dikr.name}</h2>\n          <p className=\"text-slate-400 text-sm max-w-[280px] mx-auto leading-relaxed\">\n            {t(lang, 'calibrationInstruct', { action: isRunning ? 'Stop' : 'Start' })} <b>{t(lang, 'calibrationOnce')}</b> {t(lang, 'calibrationEnd')} <b>Stop</b>.\n          </p>\n        </div>\n\n        <div className=\"text-6xl font-light tabular-nums text-blue-400 mb-12\" dir=\"ltr\">\n          {(elapsedTime / 1000).toFixed(2)}s\n        </div>\n\n        <div className=\"flex items-center gap-6\" dir=\"ltr\">\n          <button\n            onClick={handleReset}\n            disabled={isRunning || (elapsedTime === 0 && attempts.length === 0)}\n            className=\"flex items-center justify-center w-14 h-14 rounded-full bg-slate-800 text-slate-400 hover:text-white hover:bg-slate-700 transition-colors disabled:opacity-50\"\n            title={elapsedTime === 0 && attempts.length > 0 ? t(lang, 'clearAttempts') as string : ''}\n          >\n            <RotateCcw size={20} />\n          </button>\n\n          <button\n            onClick={handleToggle}\n            className={`relative flex items-center justify-center w-24 h-24 rounded-full shadow-2xl transition-all duration-300 ${\n              isRunning \n                ? 'bg-red-500/20 text-red-500 hover:bg-red-500/30 border-2 border-red-500' \n                : 'bg-blue-600 text-white hover:bg-blue-500 hover:scale-105 active:scale-95'\n            }`}\n          >\n            {isRunning ? <Square size={36} fill=\"currentColor\" /> : <Play size={40} fill=\"currentColor\" className=\"ml-2\" />}\n          </button>\n          \n          <div className=\"w-14 h-14\" />\n        </div>\n\n        {!isRunning && (attempts.length > 0 || elapsedTime > 0) && (\n          <div className=\"mt-12 w-full animate-in fade-in zoom-in duration-300 flex flex-col items-center\">\n             {attempts.length > 0 && (\n                <div className=\"flex gap-2 mb-6 flex-wrap justify-center max-w-[250px]\">\n                   {attempts.map((att, i) => (\n                      <span key={i} className=\"bg-slate-800 text-slate-300 text-sm px-3 py-1.5 rounded-lg border border-slate-700 shadow-sm\" dir=\"ltr\">\n                         {(att / 1000).toFixed(2)}s\n                      </span>\n                   ))}\n                </div>\n             )}\n            <button\n              onClick={handleSave}\n              className=\"w-full flex items-center justify-center gap-2 bg-emerald-600 hover:bg-emerald-500 text-white py-4 rounded-xl font-medium transition-colors shadow-lg shadow-emerald-900/20\"\n            >\n              <Check size={20} />\n              {attempts.length > 1 ? t(lang, 'saveAverage') : t(lang, 'saveRythm')}\n            </button>\n          </div>\n        )}\n      </main>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\components\\HistoryScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\components\\HomeScreen.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1325,1328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1325,1328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":138,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":138,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":363,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":363,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16034,16037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16034,16037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":368,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":368,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16380,16383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16380,16383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":395,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":395,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17419,17422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17419,17422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Target, Infinity as InfinityIcon, Ruler, History, Plus, Trash2, Globe, Edit3, X, Download, Share2, Github, Settings as SettingsIcon } from 'lucide-react';\nimport type { Screen, SessionMode, DikrItem, Language, DikrSession } from '../types';\nimport { t, dikrTemplates } from '../i18n';\nimport { getStatsByFilter, formatTime } from '../utils/stats';\nimport { SettingsModal } from './SettingsModal';\nimport { usePWA } from '../hooks/usePWA';\n\ninterface Props {\n  lang: Language;\n  onChangeLang: (lang: Language) => void;\n  history: DikrSession[];\n  dikrs: DikrItem[];\n  onAddDikr: (name: string) => void;\n  onDeleteDikr: (id: string) => void;\n  onEditDikr: (id: string, newName: string) => void;\n  onStartSession: (dikrId: string, mode: SessionMode, target?: number) => void;\n  onNavigate: (screen: Screen) => void;\n  onViewHistory: (dikrId?: string) => void;\n  onShowOnboarding: () => void;\n}\n\nexport function HomeScreen({ lang, onChangeLang, history, dikrs, onAddDikr, onDeleteDikr, onEditDikr, onStartSession, onViewHistory, onShowOnboarding }: Props) {\n  const [isAdding, setIsAdding] = useState(false);\n  const [showCustomInput, setShowCustomInput] = useState(false);\n  const [newName, setNewName] = useState('');\n  const [deferredPrompt, setDeferredPrompt] = useState<any>(null);\n  const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n  const { isStandalone } = usePWA();\n  \n  const [modalConfig, setModalConfig] = useState<{\n    isOpen: boolean;\n    type: 'prompt' | 'confirm';\n    title: string;\n    message?: string;\n    estimatedTimeMs?: number;\n    onConfirm: (val?: string) => void;\n  }>({ isOpen: false, type: 'confirm', title: '', onConfirm: () => {} });\n  const [modalInput, setModalInput] = useState('');\n\n  useEffect(() => {\n    const handleBeforeInstallPrompt = (e: Event) => {\n      e.preventDefault();\n      setDeferredPrompt(e);\n    };\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    return () => window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n  }, []);\n\n  const handleInstallClick = async () => {\n    if (!deferredPrompt) {\n      alert(t(lang, 'installIOSInstruction'));\n      return;\n    }\n    deferredPrompt.prompt();\n    const { outcome } = await deferredPrompt.userChoice;\n    if (outcome === 'accepted') {\n      setDeferredPrompt(null);\n    }\n  };\n\n  const handleAddCustom = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (newName.trim()) {\n      onAddDikr(newName.trim());\n      setNewName('');\n      setShowCustomInput(false);\n      setIsAdding(false);\n    }\n  };\n\n  const handleAddTemplate = (text: string) => {\n    onAddDikr(text);\n    setIsAdding(false);\n  };\n\n  const handlePromptTarget = (dikrId: string) => {\n    const dikr = dikrs.find(d => d.id === dikrId);\n    \n    if ('Notification' in window && Notification.permission === 'default') {\n      Notification.requestPermission();\n    }\n    \n    setModalInput(\"100\");\n    setModalConfig({\n      isOpen: true,\n      type: 'prompt',\n      title: t(lang, 'targetMode'),\n      message: t(lang, 'targetPrompt'),\n      estimatedTimeMs: dikr?.durationMs || undefined,\n      onConfirm: (val) => {\n        const num = parseInt(val || '', 10);\n        if (!isNaN(num) && num > 0) {\n          onStartSession(dikrId, 'target', num);\n        }\n      }\n    });\n  };\n\n  const toggleLang = () => {\n    if (lang === 'fr') onChangeLang('en');\n    else if (lang === 'en') onChangeLang('ar');\n    else onChangeLang('fr');\n  };\n\n  const handleExport = () => {\n    const data = {\n      dikrs: JSON.parse(localStorage.getItem('dikr-list') || '[]'),\n      history: JSON.parse(localStorage.getItem('dikr-history') || '[]'),\n      lang: JSON.parse(localStorage.getItem('app-lang') || '\"fr\"'),\n      onboarding: JSON.parse(localStorage.getItem('has-seen-onboarding') || 'true')\n    };\n    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `dikr-backup-${new Date().toISOString().split('T')[0]}.json`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const handleImport = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = (event) => {\n      try {\n        const data = JSON.parse(event.target?.result as string);\n        if (data.dikrs && data.history) {\n          localStorage.setItem('dikr-list', JSON.stringify(data.dikrs));\n          localStorage.setItem('dikr-history', JSON.stringify(data.history));\n          if (data.lang) localStorage.setItem('app-lang', JSON.stringify(data.lang));\n          if (data.onboarding !== undefined) localStorage.setItem('has-seen-onboarding', JSON.stringify(data.onboarding));\n          window.location.reload();\n        } else {\n          alert(t(lang, 'importError'));\n        }\n      } catch (err) {\n        alert(t(lang, 'importError'));\n      }\n    };\n    reader.readAsText(file);\n  };\n\n  const handleShare = async () => {\n    const shareData = {\n      title: t(lang, 'appTitle'),\n      text: t(lang, 'onboardingDesc'),\n      url: window.location.href,\n    };\n    try {\n      if (navigator.share) {\n        await navigator.share(shareData);\n      } else {\n        await navigator.clipboard.writeText(shareData.url);\n        alert(\"Lien copi├® ! / Link copied !\");\n      }\n    } catch (err) {\n      console.log('Erreur de partage:', err);\n    }\n  };\n\n  const globalStats = getStatsByFilter(history, 'all');\n  const todayStats = getStatsByFilter(history, 'today');\n  const templates = dikrTemplates[lang] || dikrTemplates['fr'];\n\n  return (\n    <div className=\"flex flex-col w-full max-w-md p-6 min-h-screen relative\">\n      \n      {/* Header Controls (Fixed top) */}\n      <div className=\"absolute top-6 left-6 z-10 animate-in fade-in\">\n        <button \n          onClick={() => setIsSettingsOpen(true)}\n          className=\"p-2 rounded-full bg-slate-800 border border-slate-700 text-slate-300 hover:text-white hover:bg-slate-700/80 transition-colors shadow-lg\"\n          title={t(lang, 'settingsTitle')}\n        >\n          <SettingsIcon size={20} />\n        </button>\n      </div>\n\n      <div className=\"absolute top-6 right-6 z-10 animate-in fade-in flex items-center gap-2\">\n        <button \n          onClick={toggleLang}\n          className=\"flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-800 border border-slate-700 text-slate-300 hover:text-white transition-colors text-xs font-semibold uppercase shadow-lg\"\n        >\n          <Globe size={14} />\n          {lang}\n        </button>\n      </div>\n\n      <header className=\"mt-8 mb-8 text-center animate-in fade-in\">\n        <img src=\"/icon.png\" alt=\"Dikr icon\" className=\"w-20 h-20 mx-auto mb-4 rounded-full shadow-xl shadow-blue-900/20 border border-slate-700/50 object-cover\" />\n        <h1 className=\"text-4xl font-normal leading-relaxed text-blue-50 mb-6 font-quran drop-shadow-md\" dir=\"rtl\">{t(lang, 'appTitle')}</h1>\n        \n        <div \n          onClick={() => onViewHistory()}\n          className=\"bg-slate-800/60 border border-slate-700/50 rounded-2xl p-5 mb-6 cursor-pointer hover:bg-slate-800 transition-colors flex flex-col shadow-lg backdrop-blur-sm relative overflow-hidden\"\n        >\n          <div className=\"absolute -right-4 -top-4 w-24 h-24 bg-blue-500/10 rounded-full blur-2xl pointer-events-none\"></div>\n          \n          <div className=\"flex items-center justify-between w-full relative z-10 gap-2\">\n            <div className=\"flex flex-col items-center flex-1\">\n              <span className=\"text-xs font-medium text-slate-400\">{t(lang, 'today')}</span>\n              <span className=\"text-xl font-bold text-blue-400 mt-0.5\">{todayStats.count}</span>\n            </div>\n            \n            <div className=\"flex flex-col items-center flex-1\">\n              <span className=\"text-xs font-medium text-slate-400\">{t(lang, 'targetsReached')}</span>\n              <span className=\"text-xl font-bold text-emerald-400 mt-0.5 flex items-center justify-center\"><Target size={14} className=\"mr-1\" />{globalStats.targetsReached}</span>\n            </div>\n            \n            <div className=\"flex flex-col items-center flex-1\">\n              <span className=\"text-xs font-medium text-slate-400\">{t(lang, 'timeSpent')}</span>\n              <span className=\"text-xl font-bold text-amber-400 mt-0.5\" dir=\"ltr\">{formatTime(globalStats.timeMs, lang)}</span>\n            </div>\n            \n            <div className=\"pl-2 border-l border-slate-700/50 flex items-center justify-center text-slate-400 hover:text-blue-400 transition-colors\">\n               <div className=\"w-10 h-10 rounded-full bg-slate-700/50 flex flex-col items-center justify-center\">\n                 <History size={18} />\n                 <span className=\"text-[9px] mt-0.5\" style={{lineHeight:'1'}}>{lang === 'ar' ? 'Ï│Ï¼┘ä' : 'Log'}</span>\n               </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"flex items-center justify-between mb-4 animate-in fade-in\">\n        <h2 className=\"text-lg font-semibold text-slate-200\">\n          {t(lang, 'myDikrs')} <span className=\"text-slate-500 ml-2 text-sm font-normal\">({dikrs.length})</span>\n        </h2>\n        <button \n          onClick={() => setIsAdding(true)}\n          className=\"p-2 rounded-full bg-blue-600/20 text-blue-400 hover:bg-blue-600 hover:text-white transition-colors\"\n        >\n          <Plus size={20} />\n        </button>\n      </div>\n\n      <ul className=\"flex flex-col gap-4 flex-1 pb-10\">\n        {dikrs.map((dikr, i) => (\n          <li key={dikr.id} className=\"bg-slate-800/40 border border-slate-700/50 rounded-2xl p-4 flex flex-col gap-4 relative group animate-in slide-in-from-bottom-2\" style={{ animationDelay: `${i * 50}ms`, animationFillMode: 'both' }}>\n            \n            <div className=\"flex justify-between items-start gap-4\" dir={lang === 'ar' ? 'rtl' : 'ltr'}>\n              <div className=\"flex flex-col gap-2 flex-1 min-w-0\">\n                <h3 className=\"text-lg font-medium text-white leading-tight break-words\">{dikr.name}</h3>\n                \n                {dikr.durationMs && (\n                   <div className=\"text-xs text-slate-400 bg-slate-800/60 px-2 py-1.5 rounded-md inline-block self-start border border-slate-700/30\">\n                     {t(lang, 'calibrated')}: <span className=\"font-mono text-slate-300 ml-1\">{(dikr.durationMs / 1000).toFixed(1)}s</span>\n                   </div>\n                )}\n                \n                <div className=\"flex items-center gap-2 flex-wrap mt-1\">\n                  {(() => {\n                    const s = getStatsByFilter(history.filter(h => h.dikrId === dikr.id), 'today');\n                    return s.count > 0 ? (\n                      <div className=\"flex items-center gap-2 flex-wrap\" dir=\"ltr\">\n                        <span className=\"text-xs font-medium text-blue-300 bg-blue-900/30 px-2 py-1 rounded-md\">\n                          {t(lang, 'todayCountShort')} {s.count}\n                        </span>\n                        {s.targetsReached > 0 && (\n                          <span className=\"text-xs font-medium text-emerald-300 bg-emerald-900/30 px-2 py-1 rounded-md flex items-center\">\n                            <Target size={10} className=\"mr-1\" />{s.targetsReached}\n                          </span>\n                        )}\n                        {s.timeMs > 0 && (\n                           <span className=\"text-xs font-medium text-amber-300 bg-amber-900/30 px-2 py-1 rounded-md\">\n                             {formatTime(s.timeMs, lang)}\n                           </span>\n                        )}\n                      </div>\n                    ) : null;\n                  })()}\n                </div>\n              </div>\n\n              {/* Action buttons */}\n              <div className=\"flex gap-1 shrink-0 bg-slate-800/80 rounded-lg backdrop-blur p-1\">\n                <button \n                  onClick={() => onViewHistory(dikr.id)}\n                  className=\"text-slate-500 hover:text-blue-400 transition-colors p-1.5\"\n                  title={t(lang, 'journalTitle')}\n                >\n                  <History size={16} />\n                </button>\n                <button \n                  onClick={() => {\n                    setModalInput(dikr.name);\n                    setModalConfig({\n                      isOpen: true,\n                      type: 'prompt',\n                      title: \"Renommer\",\n                      onConfirm: (val) => {\n                        if (val && val.trim()) onEditDikr(dikr.id, val.trim());\n                      }\n                    });\n                  }}\n                  className=\"text-slate-500 hover:text-emerald-400 transition-colors p-1.5\"\n                  title=\"Renommer\"\n                >\n                  <Edit3 size={16} />\n                </button>\n                <button \n                  onClick={() => {\n                    setModalConfig({\n                      isOpen: true,\n                      type: 'confirm',\n                      title: \"Supprimer\",\n                      message: \"Voulez-vous vraiment supprimer ce dikr ?\",\n                      onConfirm: () => onDeleteDikr(dikr.id)\n                    });\n                  }}\n                  className=\"text-slate-500 hover:text-red-400 transition-colors p-1.5\"\n                  title=\"Supprimer\"\n                >\n                  <Trash2 size={16} />\n                </button>\n              </div>\n            </div>\n\n\n            {!dikr.durationMs ? (\n              <button\n                onClick={() => onStartSession(dikr.id, 'calibration')}\n                className=\"bg-blue-600/20 text-blue-400 hover:bg-blue-600 hover:text-white w-full py-3 rounded-xl font-medium transition-colors flex items-center justify-center gap-2 mt-2\"\n              >\n                <Ruler size={18} />\n                {t(lang, 'calibrateBtn')}\n              </button>\n            ) : (\n              <div className=\"flex gap-2 mt-2\">\n                <button\n                  onClick={() => onStartSession(dikr.id, 'free')}\n                  className=\"flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-medium transition-colors flex flex-col items-center justify-center gap-1\"\n                >\n                  <InfinityIcon size={20} className=\"text-emerald-400\" />\n                  <span className=\"text-sm\">{t(lang, 'freeMode')}</span>\n                </button>\n                <button\n                  onClick={() => handlePromptTarget(dikr.id)}\n                  className=\"flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-medium transition-colors flex flex-col items-center justify-center gap-1\"\n                >\n                  <Target size={20} className=\"text-purple-400\" />\n                  <span className=\"text-sm\">{t(lang, 'targetMode')}</span>\n                </button>\n                <button\n                  title={t(lang, 'recalibrateBtn')}\n                  onClick={() => onStartSession(dikr.id, 'calibration')}\n                  className=\"w-14 bg-slate-800 border border-slate-700 hover:bg-slate-700 text-slate-400 py-3 rounded-xl transition-colors flex flex-col items-center justify-center shrink-0\"\n                >\n                  <Ruler size={18} />\n                </button>\n              </div>\n            )}\n          </li>\n        ))}\n      </ul>\n\n      {/* Footer Actions */}\n      <div className=\"mt-8 flex flex-col items-center justify-center gap-6 text-sm pb-16\">\n        <div className=\"flex flex-wrap items-center justify-center gap-3\">\n          <button onClick={handleShare} className=\"text-slate-300 bg-slate-800 hover:bg-slate-700 rounded-full px-5 py-2.5 transition-colors flex items-center gap-2 font-medium border border-slate-700\">\n             <Share2 size={16} /> {t(lang, 'shareAppShort' as any)}\n          </button>\n          \n          {!isStandalone && (\n            <button onClick={handleInstallClick} className=\"text-white bg-blue-600 hover:bg-blue-500 rounded-full px-5 py-2.5 transition-colors flex items-center gap-2 font-medium shadow-lg shadow-blue-900/20\">\n               <Download size={16} /> {t(lang, 'installAppShort' as any)}\n            </button>\n          )}\n        </div>\n        \n        <a \n          href=\"https://github.com/khalid10830/dikr-app\" \n          target=\"_blank\" \n          rel=\"noopener noreferrer\"\n          className=\"flex items-center justify-center gap-1.5 text-slate-500 hover:text-slate-400 transition-colors pt-5 border-t border-slate-800/50 w-full max-w-[250px]\"\n        >\n          <Github size={14} />\n          <span className=\"text-xs font-medium\">Open Source</span>\n          <span className=\"text-[10px] opacity-40 mx-1\">ÔÇó</span>\n          <span className=\"text-[10px] opacity-70\">┬® 2026</span>\n        </a>\n      </div>\n      \n      <SettingsModal \n        lang={lang}\n        isOpen={isSettingsOpen}\n        onClose={() => setIsSettingsOpen(false)}\n        onImport={() => {\n          // Trigger file input click programmatically since we removed it from DOM\n          const input = document.createElement('input');\n          input.type = 'file';\n          input.accept = '.json';\n          input.onchange = handleImport as any;\n          input.click();\n        }}\n        onExport={handleExport}\n        onShowTutorial={onShowOnboarding}\n      />\n      \n      {/* ADD DIKR OVERLAY MODAL */}\n      {isAdding && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n          <div className=\"absolute inset-0 bg-slate-900/80 backdrop-blur-sm\" onClick={() => setIsAdding(false)} />\n          <div className=\"bg-slate-800 border border-slate-700 w-full max-w-md max-h-[85vh] rounded-2xl shadow-2xl z-10 flex flex-col animate-in zoom-in-95 duration-200\">\n            <header className=\"flex items-center justify-between p-4 border-b border-slate-700\">\n               <h3 className=\"text-lg font-semibold text-white\">{t(lang, 'suggestedDikrs')}</h3>\n               <button onClick={() => setIsAdding(false)} className=\"text-slate-400 hover:text-white\"><X size={24} /></button>\n            </header>\n            \n            <div className=\"overflow-y-auto p-4 flex-1\">\n              {showCustomInput ? (\n                <form onSubmit={handleAddCustom} className=\"flex flex-col gap-4 animate-in slide-in-from-right-4\">\n                  <h4 className=\"text-sm font-medium text-slate-400\">{t(lang, 'customDikrLabel')}</h4>\n                  <textarea \n                    autoFocus\n                    rows={4}\n                    placeholder={t(lang, 'customDikrPlaceholder')}\n                    value={newName}\n                    onChange={(e) => setNewName(e.target.value)}\n                    dir={lang === 'ar' ? 'rtl' : 'ltr'}\n                    className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-blue-500 placeholder-slate-600 resize-none\"\n                  />\n                  <div className=\"flex gap-2\">\n                    <button type=\"button\" onClick={() => setShowCustomInput(false)} className=\"flex-1 bg-slate-700 text-white rounded-xl py-3 font-medium\">{t(lang, 'cancelBtn')}</button>\n                    <button type=\"submit\" disabled={!newName.trim()} className=\"flex-1 bg-blue-600 text-white rounded-xl py-3 font-medium disabled:opacity-50\">{t(lang, 'addBtn')}</button>\n                  </div>\n                </form>\n              ) : (\n                <div className=\"flex flex-col gap-2\">\n                  <button \n                    onClick={() => setShowCustomInput(true)}\n                    className=\"flex flex-col items-center justify-center gap-2 p-4 bg-blue-600/10 border border-blue-500/30 text-blue-400 rounded-xl hover:bg-blue-600/20 transition-colors mb-4\"\n                  >\n                    <Edit3 size={20} />\n                    <span className=\"font-medium\">{t(lang, 'addCustomDikr')}</span>\n                  </button>\n                  \n                  {templates.map((tpl, i) => (\n                    <button \n                      key={i} \n                      onClick={() => handleAddTemplate(tpl)}\n                      className=\"text-left bg-slate-800/50 hover:bg-slate-700 p-4 rounded-xl border border-slate-700/50 transition-colors\"\n                      dir={lang === 'ar' ? 'rtl' : 'ltr'}\n                    >\n                      <span className=\"text-slate-200 text-sm leading-relaxed block\">{tpl}</span>\n                    </button>\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Custom Global Modals (Prompt / Confirm) */}\n      {modalConfig.isOpen && (\n        <div className=\"fixed inset-0 z-[60] flex items-center justify-center p-4\">\n          <div className=\"absolute inset-0 bg-slate-900/80 backdrop-blur-sm\" onClick={() => setModalConfig(prev => ({ ...prev, isOpen: false }))} />\n          <div className=\"bg-slate-800 border border-slate-700 w-full max-w-sm rounded-2xl shadow-2xl z-10 flex flex-col animate-in zoom-in-95 duration-200 overflow-hidden\" dir={lang === 'ar' ? 'rtl' : 'ltr'}>\n            <div className=\"p-6 flex flex-col gap-4 text-center\">\n              <h3 className=\"text-xl font-semibold text-white\">{modalConfig.title}</h3>\n              {modalConfig.message && <p className=\"text-slate-400 text-sm\">{modalConfig.message}</p>}\n              \n              {modalConfig.type === 'prompt' && (\n                <div className=\"flex flex-col gap-2 w-full mt-2\">\n                  <input \n                    type=\"text\"\n                    autoFocus\n                    value={modalInput}\n                    onChange={(e) => setModalInput(e.target.value)}\n                    className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-blue-500 text-center\"\n                  />\n                  {modalConfig.estimatedTimeMs && parseInt(modalInput, 10) > 0 && (\n                    <div className=\"text-xs font-medium text-slate-400 flex items-center justify-center gap-1.5 bg-slate-900/50 py-2 rounded-lg border border-slate-800\">\n                      <span>{t(lang, 'estimatedTime')}</span>\n                      <span className=\"text-emerald-400\" dir=\"ltr\">{formatTime(modalConfig.estimatedTimeMs * parseInt(modalInput, 10), lang)}</span>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n            <div className=\"flex border-t border-slate-700\">\n              <button \n                onClick={() => setModalConfig(prev => ({ ...prev, isOpen: false }))} \n                className={`flex-1 py-4 text-slate-400 hover:text-slate-200 hover:bg-slate-700/50 transition-colors font-medium border-slate-700 ${lang === 'ar' ? 'border-l' : 'border-r'}`}\n              >\n                {t(lang, 'cancelBtn')}\n              </button>\n              <button \n                onClick={() => {\n                  modalConfig.onConfirm(modalInput);\n                  setModalConfig(prev => ({ ...prev, isOpen: false }));\n                }} \n                className=\"flex-1 py-4 text-blue-400 hover:text-blue-300 hover:bg-slate-700/50 transition-colors font-medium focus:outline-none\"\n              >\n                {/* On utilise un texte g├®n├®rique comme Valider ou Confirmer */}\n                {modalConfig.type === 'confirm' ? 'OK' : t(lang, 'addBtn')}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\components\\OnboardingScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\components\\SessionScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\components\\SettingsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\hooks\\useLocalStorage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\hooks\\usePWA.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\hooks\\usePWA.ts:12:5\n  10 |     // D├®finir l'├®tat initial\n  11 |     const nav = window.navigator as Navigator & { standalone?: boolean };\n> 12 |     setIsStandalone(mediaQuery.matches || nav.standalone === true);\n     |     ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  13 |\n  14 |     // ├ëcouter les changements (si l'utilisateur installe l'app pendant qu'il l'utilise)\n  15 |     const handleChange = (e: MediaQueryListEvent) => {","line":12,"column":5,"nodeType":null,"endLine":12,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\n\nexport function usePWA() {\n  const [isStandalone, setIsStandalone] = useState(false);\n\n  useEffect(() => {\n    // V├®rifier si l'app est lanc├®e en mode standalone (PWA install├®e)\n    const mediaQuery = window.matchMedia('(display-mode: standalone)');\n    \n    // D├®finir l'├®tat initial\n    const nav = window.navigator as Navigator & { standalone?: boolean };\n    setIsStandalone(mediaQuery.matches || nav.standalone === true);\n\n    // ├ëcouter les changements (si l'utilisateur installe l'app pendant qu'il l'utilise)\n    const handleChange = (e: MediaQueryListEvent) => {\n      setIsStandalone(e.matches);\n    };\n\n    if (mediaQuery.addEventListener) {\n      mediaQuery.addEventListener('change', handleChange);\n    } else {\n      // Fallback pour anciens navigateurs\n      mediaQuery.addListener(handleChange);\n    }\n\n    return () => {\n      if (mediaQuery.removeEventListener) {\n        mediaQuery.removeEventListener('change', handleChange);\n      } else {\n        mediaQuery.removeListener(handleChange);\n      }\n    };\n  }, []);\n\n  return { isStandalone };\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\i18n\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\utils\\stats.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\KhalidDebdi\\.gemini\\antigravity\\playground\\cryo-meteorite\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
